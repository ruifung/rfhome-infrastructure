---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: firefly-iii-data-importer
  namespace: home-network
spec:
  releaseName: firefly-iii-data-importer
  chart:
    spec:
      chart: importer
      version: 1.3.1
      reconcileStrategy: ChartVersion
      sourceRef:
        kind: HelmRepository
        name: firefly-iii
  interval: 15m
  postRenderers:
    - kustomize:
        patches:
          - patch: |
              - op: "add"
                path: "/spec/template/spec/runtimeClassName"
                value: "gvisor"
            target:
              kind: Deployment
          - patch: |
              - op: "add"
                path: "/metadata/labels/external-dns"
                value: "local-pdns"
            target:
              kind: Ingress
  values:
    image:
      repository: fireflyiii/data-importer
      tag: version-1.5.2
    fireflyiii:
      url: http://firefly-iii:80
      vanityUrl: https://firefly-iii.services.home.yrf.me
    config:
      env:
        TZ: Asia/Kuala_Lumpur
        IGNORE_DUPLICATE_ERRORS: "false"
      files: []
    ingress:
      enabled: true
      className: traefik-traefik
      # annotations:
      #   traefik.ingress.kubernetes.io/router.middlewares: home-network-ak-outpost-authentik-embedded-outpost@kubernetescrd
      hosts:
      - firefly-iii-data-importer.services.home.yrf.me
      tls:
      - secretName: services-wildcard-cert
        hosts:
        - firefly-iii-data-importer.services.home.yrf.me